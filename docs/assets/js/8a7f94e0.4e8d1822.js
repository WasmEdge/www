"use strict";(self.webpackChunkbook=self.webpackChunkbook||[]).push([[8833],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var o=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,o,n=function(e,t){if(null==e)return{};var a,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=o.createContext({}),p=function(e){var t=o.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=p(e.components);return o.createElement(i.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(a),m=n,h=c["".concat(i,".").concat(m)]||c[m]||d[m]||r;return a?o.createElement(h,s(s({ref:t},u),{},{components:a})):o.createElement(h,s({ref:t},u))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,s=new Array(r);s[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[c]="string"==typeof e?e:n,s[1]=l;for(var p=2;p<r;p++)s[p]=a[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,a)}m.displayName="MDXCreateElement"},68562:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var o=a(87462),n=(a(67294),a(3905));const r={sidebar_position:1},s="Set up Rust toolchain",l={unversionedId:"develop/rust/setup",id:"develop/rust/setup",title:"Set up Rust toolchain",description:"In the following chapters, we will show how to build and compile Rust programs into WASM bytecode and then run them in WasmEdge.",source:"@site/docs/develop/rust/setup.md",sourceDirName:"develop/rust",slug:"/develop/rust/setup",permalink:"/docs/develop/rust/setup",draft:!1,editUrl:"https://github.com/wasmedge/docs/blob/main/docs/develop/rust/setup.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"developSidebar",previous:{title:"Develop WASM Apps in Rust",permalink:"/docs/category/develop-wasm-apps-in-rust"},next:{title:"Hello world",permalink:"/docs/develop/rust/hello_world"}},i={},p=[{value:"Install WasmEdge",id:"install-wasmedge",level:2},{value:"Install Rust",id:"install-rust",level:2},{value:"Set up the Rust compiler&#39;s target",id:"set-up-the-rust-compilers-target",level:2},{value:"Special notes for networking apps",id:"special-notes-for-networking-apps",level:2},{value:"Tokio support",id:"tokio-support",level:3},{value:"TLS on MacOS",id:"tls-on-macos",level:3}],u={toc:p},c="wrapper";function d(e){let{components:t,...a}=e;return(0,n.kt)(c,(0,o.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"set-up-rust-toolchain"},"Set up Rust toolchain"),(0,n.kt)("p",null,"In the following chapters, we will show how to build and compile Rust programs into WASM bytecode and then run them in WasmEdge."),(0,n.kt)("p",null,"Before we start, let's set up the software we need."),(0,n.kt)("h2",{id:"install-wasmedge"},"Install WasmEdge"),(0,n.kt)("p",null,"Use the following command line to install WasmEdge on your machine. If you use Windows or other non-Unix-like platforms, please refer to the ",(0,n.kt)("a",{parentName:"p",href:"/docs/start/install#install"},"WasmEdge installation"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"curl -sSf https://raw.githubusercontent.com/WasmEdge/WasmEdge/master/utils/install.sh | bash\n")),(0,n.kt)("h2",{id:"install-rust"},"Install Rust"),(0,n.kt)("p",null,"Use the following command line to install Rust on your machine. If you use Windows or other non-Unix-like platforms, please refer to the ",(0,n.kt)("a",{parentName:"p",href:"https://www.rust-lang.org/tools/install"},"Rust installation instruction"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n")),(0,n.kt)("h2",{id:"set-up-the-rust-compilers-target"},"Set up the Rust compiler's target"),(0,n.kt)("p",null,"To build a WASM file running in server-side WebAssembly like WasmEdge, we need to add the ",(0,n.kt)("inlineCode",{parentName:"p"},"wasm32-wasi")," target for the Rust compiler after Rust is installed."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"rustup target add wasm32-wasi\n")),(0,n.kt)("h2",{id:"special-notes-for-networking-apps"},"Special notes for networking apps"),(0,n.kt)("h3",{id:"tokio-support"},"Tokio support"),(0,n.kt)("p",null,"WasmEdge supports async networking APIs provided by ",(0,n.kt)("a",{parentName:"p",href:"https://tokio.rs/"},"Tokio")," and related crates. If you have tokio in your ",(0,n.kt)("inlineCode",{parentName:"p"},"Cargo.toml"),", you\nneed to add a few config flags to help the Rust compiler choose the correct feature branches in the library source code. Here is an example of ",(0,n.kt)("inlineCode",{parentName:"p"},"cargo build")," command for compiling a tokio app to Wasm."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'RUSTFLAGS="--cfg wasmedge --cfg tokio_unstable" cargo build --target wasm32-wasi --release\n')),(0,n.kt)("p",null,"Alternatively, you could add these lines to the ",(0,n.kt)("inlineCode",{parentName:"p"},".cargo/config.toml")," file."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-toml"},'[build]\ntarget = "wasm32-wasi"\nrustflags = ["--cfg", "wasmedge", "--cfg", "tokio_unstable"]\n')),(0,n.kt)("p",null,"Once you have these lines in ",(0,n.kt)("inlineCode",{parentName:"p"},".cargo/config.toml"),", you can simply use the regular ",(0,n.kt)("inlineCode",{parentName:"p"},"cargo")," command."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"cargo build --target wasm32-wasi --release\n")),(0,n.kt)("h3",{id:"tls-on-macos"},"TLS on MacOS"),(0,n.kt)("p",null,"The standard ",(0,n.kt)("inlineCode",{parentName:"p"},"cargo")," toolchain can support the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/rustls/rustls"},"Rust TLS")," library on Linux. However,\non MacOS, you need a special version of the Clang tool, released from the official ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/WebAssembly/wasi-sdk"},"wasi-sdk"),", in order to support TLS libraries."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"When you compile Rust TLS source code to Wasm on Linux, the result Wasm file is cross-platform and can run correctly on any platform with WasmEdge installed. This section is only applicable when you need to ",(0,n.kt)("strong",{parentName:"p"},"compile")," Rust TLS source code on MacOS.")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/WebAssembly/wasi-sdk/releases"},"Download the latest wasi-sdk release")," for your platform and\nexpand it into a directory. Point the ",(0,n.kt)("inlineCode",{parentName:"p"},"WASI_SDK_PATH")," variable to this directory and export a ",(0,n.kt)("inlineCode",{parentName:"p"},"CC")," variable for the default Clang."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'export WASI_SDK_PATH /path/to/wasi-sdk-22.0\nexport CC="${WASI_SDK_PATH}/bin/clang --sysroot=${WASI_SDK_PATH}/share/wasi-sysroot"\n')),(0,n.kt)("p",null,"That's it. Now you can use the ",(0,n.kt)("inlineCode",{parentName:"p"},"cargo")," tools on MacOS to compile tokio libraries with ",(0,n.kt)("inlineCode",{parentName:"p"},"rust-tls")," feature turned on."))}d.isMDXComponent=!0}}]);