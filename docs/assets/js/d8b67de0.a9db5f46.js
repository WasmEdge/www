"use strict";(self.webpackChunkbook=self.webpackChunkbook||[]).push([[9930],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},g="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),g=u(n),c=i,m=g["".concat(l,".").concat(c)]||g[c]||d[c]||r;return n?a.createElement(m,s(s({ref:t},p),{},{components:n})):a.createElement(m,s({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[g]="string"==typeof e?e:i,s[1]=o;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},27169:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var a=n(87462),i=(n(67294),n(3905));const r={sidebar_position:6},s="Best Practice",o={unversionedId:"contribute/plugin/best_practice",id:"contribute/plugin/best_practice",title:"Best Practice",description:"When developing a WasmEdge plugin, it's important to follow best practices to ensure the plugin is well purformed, reliable, and efficient. Here are some key best practices to follow:",source:"@site/docs/contribute/plugin/best_practice.md",sourceDirName:"contribute/plugin",slug:"/contribute/plugin/best_practice",permalink:"/docs/contribute/plugin/best_practice",draft:!1,editUrl:"https://github.com/wasmedge/docs/blob/main/docs/contribute/plugin/best_practice.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"contributeSidebar",previous:{title:"Writing Tests for WasmEdge Plugins",permalink:"/docs/contribute/plugin/test_plugin"},next:{title:"Testing",permalink:"/docs/contribute/test"}},l={},u=[{value:"Using the Latest Version of WasmEdge",id:"using-the-latest-version-of-wasmedge",level:2},{value:"Installing the Latest Version",id:"installing-the-latest-version",level:3},{value:"Updating Existing Plugins",id:"updating-existing-plugins",level:3},{value:"Choosing the Appropriate Programming Language",id:"choosing-the-appropriate-programming-language",level:2},{value:"Writing and Compiling the Plugin",id:"writing-and-compiling-the-plugin",level:2},{value:"Testing the Plugin",id:"testing-the-plugin",level:2},{value:"Securing the Plugin",id:"securing-the-plugin",level:2},{value:"Publishing the Plugin",id:"publishing-the-plugin",level:2},{value:"Exporting the SDKs in Rust",id:"exporting-the-sdks-in-rust",level:2},{value:"Creating a Rust Library",id:"creating-a-rust-library",level:3},{value:"Building the Rust Library",id:"building-the-rust-library",level:3},{value:"Packaging the Rust SDK",id:"packaging-the-rust-sdk",level:3},{value:"Contributing to the WasmEdge Community",id:"contributing-to-the-wasmedge-community",level:2}],p={toc:u},g="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(g,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"best-practice"},"Best Practice"),(0,i.kt)("p",null,"When developing a WasmEdge plugin, it's important to follow best practices to ensure the plugin is well purformed, reliable, and efficient. Here are some key best practices to follow:"),(0,i.kt)("h2",{id:"using-the-latest-version-of-wasmedge"},"Using the Latest Version of WasmEdge"),(0,i.kt)("p",null,"Always use the latest version of WasmEdge to take advantage of the most recent features, improvements, and security updates. "),(0,i.kt)("h3",{id:"installing-the-latest-version"},"Installing the Latest Version"),(0,i.kt)("p",null,"To install the latest version of WasmEdge, follow the installation instructions in the ",(0,i.kt)("a",{parentName:"p",href:"https://wasmedge.org/docs/start/install/"},"WasmEdge documentation"),"."),(0,i.kt)("h3",{id:"updating-existing-plugins"},"Updating Existing Plugins"),(0,i.kt)("p",null,"If you have existing plugins that were developed with an older version of WasmEdge, you may need to update them to work with the latest version. This could involve updating the plugin code to use new features or changes in the ",(0,i.kt)("a",{parentName:"p",href:"https://wasmedge.org/docs/category/api-reference/"},"WasmEdge API"),", or updating the build process to use the latest version of WasmEdge."),(0,i.kt)("p",null,"Remember, using the latest version of WasmEdge not only ensures that you're leveraging the most recent features, but also provides the latest security updates to protect your applications."),(0,i.kt)("h2",{id:"choosing-the-appropriate-programming-language"},"Choosing the Appropriate Programming Language"),(0,i.kt)("p",null,"WasmEdge plugins can be developed in several languages including ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/plugin/develop_plugin_c"},"C"),", ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/plugin/develop_plugin_cpp"},"C++"),", and ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/plugin/develop_plugin_rustsdk"},"Rust"),". The choice of language depends on the specific requirements of the plugin and the developer's expertise. The C API is recommended for most use cases due to its simplicity and wide support. However, complex plugins might benefit from the enhanced features of C++ or Rust."),(0,i.kt)("h2",{id:"writing-and-compiling-the-plugin"},"Writing and Compiling the Plugin"),(0,i.kt)("p",null,"When creating a WasmEdge plugin:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Code Writing"),": While develop your plugin, write clear, maintainable code, and document it well for easy understanding and future maintenance.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Compiling to Shared Library"),": Use a compiler like ",(0,i.kt)("inlineCode",{parentName:"p"},"gcc")," for C or ",(0,i.kt)("inlineCode",{parentName:"p"},"g++")," for C++ to compile your code into a shared library. For example, in a Linux environment, you might use ",(0,i.kt)("inlineCode",{parentName:"p"},"gcc -shared -fPIC -o my_plugin.so my_plugin.c")," for a C plugin.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Error Handling and Input Validation"),": Efficitive error handling to catch and manage potential issues. Validate all inputs thoroughly to ensure the plugin's stability and security."))),(0,i.kt)("h2",{id:"testing-the-plugin"},"Testing the Plugin"),(0,i.kt)("p",null,"Testing is a crucial part of the plugin development process. It ensures that the plugin behaves as expected, meets the requirements, and performs optimally. WasmEdge provides a set of tests for various plugins in its ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/WasmEdge/WasmEdge/tree/master/test/plugins"},"repository")," that you can use as references for writing your own tests."),(0,i.kt)("p",null,"To run tests for the WasmEdge plugin, you'll need to follow a few steps. In this case, we'll use the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasmedge-image")," plugin as an example."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Step 1: Build the WasmEdge Runtime and WasmEdge-image Plugin"),"\nFirst, you need to build both the ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/source/build_from_src"},"build WasmEdge")," and the ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/source/plugin/image"},"wasmedge-image")," plugin.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Step 2: Run the Tests"),"\nThe WasmEdge repository provides a set of tests for various plugins, including ",(0,i.kt)("inlineCode",{parentName:"p"},"wasmedge-image"),". You can find the test cases in the ",(0,i.kt)("inlineCode",{parentName:"p"},"test/plugins/wasmedge_image")," directory of the repository."),(0,i.kt)("p",{parentName:"li"},"   To run these tests, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"ctest")," command from the build directory:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd ../../../test/plugins/wasmedge_image\nmkdir build && cd build\ncmake ..\nmake\nctest\n")),(0,i.kt)("p",{parentName:"li"},"This will run all the unit tests and integration tests for the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasmedge-image "),"plugin. These tests ensure that the plugin behaves as expected, meets the requirements, and performs optimally. They also verify that the plugin correctly integrates with the WebAssembly program and that the WebAssembly program can call the plugin's functions correctly.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Step 3: Analyze the Test Results"),"\nAfter running the tests, analyze the results to identify any issues or bugs. If any test fails, you should debug the issue, fix the problem, and then rerun the tests to ensure that the fix works as expected."))),(0,i.kt)("p",null,"By following these steps, you can effectively run tests for the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasmedge-image")," plugin or any other WasmEdge plugin."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"If you want to develop your own tests follow ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/plugin/test_plugin"},"Writing Tests for WasmEdge Plugins")," for details.")),(0,i.kt)("h2",{id:"securing-the-plugin"},"Securing the Plugin"),(0,i.kt)("p",null,"Security is a vital part of any software development process. It involves several aspects, including securing the code, verifying inputs, handling errors properly, and using secure coding practices. When developing a WasmEdge plugin, it's essential to follow these best practices:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Validate Inputs:")," Always validate the inputs to your functions. This can prevent many types of attacks, including buffer overflow attacks and code injection attacks."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"WasmEdge_Result Add(void *, const WasmEdge_CallingFrameContext *,\n                     const WasmEdge_Value *In, WasmEdge_Value *Out) {\n   if (In[0].Type != WasmEdge_ValType_I32 || In[1].Type != WasmEdge_ValType_I32) {\n   return WasmEdge_Result_Error;\n   }\n   // Rest of the function...\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Handle Errors:")," Always handle errors properly. Don't ignore return values that indicate an error, and don't continue execution after an error occurs."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"WasmEdge_Result Add(void *, const WasmEdge_CallingFrameContext *,\n                     const WasmEdge_Value *In, WasmEdge_Value *Out) {\n   // Check the input types...\n   int32_t Val1 = WasmEdge_ValueGetI32(In[0]);\n   int32_t Val2 = WasmEdge_ValueGetI32(In[1]);\n   if (Val1 == INT32_MIN || Val2 == INT32_MIN) {\n   return WasmEdge_Result_Error;\n   }\n   // Rest of the function...\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Use Secure Coding Practices:")," Follow secure coding practices in your chosen language. For example, avoid using unsafe functions, use strong types, and avoid using global variables."))),(0,i.kt)("h2",{id:"publishing-the-plugin"},"Publishing the Plugin"),(0,i.kt)("p",null,"Once you have developed, tested, and documented your WasmEdge plugin, it\u2019s time to publish it for others to use. You need to follow following steps for publishing your plugin:"),(0,i.kt)("h2",{id:"exporting-the-sdks-in-rust"},"Exporting the SDKs in Rust"),(0,i.kt)("p",null,"In addition to C and C++ SDKs, you can also create an SDK for Rust developers. This involves creating a Rust library that provides a Rust interface to your plugin's functionality."),(0,i.kt)("h3",{id:"creating-a-rust-library"},"Creating a Rust Library"),(0,i.kt)("p",null,"You can create a Rust library that provides a Rust interface to your plugin's functionality. This involves writing Rust code that calls the functions in your plugin and provides a Rust-friendly API."),(0,i.kt)("p",null,"In the ",(0,i.kt)("a",{parentName:"p",href:"/docs/contribute/source/plugin/image"},"wasmedge-image")," plugin's case, you might have something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-rust"},"// lib.rs\nextern crate wasmedge_image;\n\nuse wasmedge_image::Image;\n\npub fn load_image(path: &str) -> Result<Image, wasmedge_image::Error> {\n    Image::open(path)\n}\n")),(0,i.kt)("p",null,"In this Rust library, a single ",(0,i.kt)("inlineCode",{parentName:"p"},"load_image")," function is provided that calls the ",(0,i.kt)("inlineCode",{parentName:"p"},"open")," function from the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasmedge-image")," plugin."),(0,i.kt)("h3",{id:"building-the-rust-library"},"Building the Rust Library"),(0,i.kt)("p",null,"You can build your Rust library using Cargo, the Rust package manager. This will produce a ",(0,i.kt)("inlineCode",{parentName:"p"},".so")," file that can be loaded by the WasmEdge runtime."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cargo build --release\n")),(0,i.kt)("h3",{id:"packaging-the-rust-sdk"},"Packaging the Rust SDK"),(0,i.kt)("p",null,"Package the Rust library and the header file into a tarball or a similar package format. This makes it easy for other developers to download and install your SDK."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"tar czvf wasmedge_image_rust_sdk.tar.gz libwasmedge_image.so wasmedge_image.h\n")),(0,i.kt)("p",null,"With this package, other rust developers can easily use your plugin in their applications. They just need to include your header file in their code, and link against your rust library when they compile their application."),(0,i.kt)("p",null,"Now, when you're ready to publish your plugin and the corresponding SDK, can publish your plugin on the official WasmEdge ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/WasmEdge/WasmEdge/tree/master/plugins"},"plugin repository")," by creating a pull request into it or any other repository of your choice. Make sure to include the documentation and any other resources (like test files) with your plugin."),(0,i.kt)("h2",{id:"contributing-to-the-wasmedge-community"},"Contributing to the WasmEdge Community"),(0,i.kt)("p",null,"As an open-source contributor, you can share your plugin with the community by submitting it to the official ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/WasmEdge/WasmEdge"},"WasmEdge repository"),". This allows others to benefit from your work."),(0,i.kt)("p",null,"By following these best practices, you can ensure a successful and efficient plugin development process for WasmEdge."))}d.isMDXComponent=!0}}]);