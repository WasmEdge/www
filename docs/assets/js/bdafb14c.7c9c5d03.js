"use strict";(self.webpackChunkbook=self.webpackChunkbook||[]).push([[8244],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),u=p(n),c=i,h=u["".concat(s,".").concat(c)]||u[c]||m[c]||o;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,l=new Array(o);l[0]=c;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[u]="string"==typeof e?e:i,l[1]=r;for(var p=2;p<o;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},45081:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const o={sidebar_position:2},l="Native Go with WASI (Go 1.21+)",r={unversionedId:"develop/go/native-go-wasi",id:"develop/go/native-go-wasi",title:"Native Go with WASI (Go 1.21+)",description:"Starting with Go 1.21, the Go toolchain natively supports compiling applications to the WebAssembly System Interface (WASI). This enables developers to build WebAssembly applications using the standard Go compiler and run them on WASI-compliant runtimes such as WasmEdge.",source:"@site/docs/develop/go/native-go-wasi.md",sourceDirName:"develop/go",slug:"/develop/go/native-go-wasi",permalink:"/docs/develop/go/native-go-wasi",draft:!1,editUrl:"https://github.com/wasmedge/docs/blob/main/docs/develop/go/native-go-wasi.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"developSidebar",previous:{title:"TinyGo",permalink:"/docs/develop/go/hello_world"},next:{title:"Deploy WasmEdge apps in Kubernetes",permalink:"/docs/category/deploy-wasmedge-apps-in-kubernetes"}},s={},p=[{value:"TinyGo vs Native Go",id:"tinygo-vs-native-go",level:2},{value:"Hello World example",id:"hello-world-example",level:2},{value:"hello.go",id:"hellogo",level:3},{value:"Build",id:"build",level:3},{value:"Run with WasmEdge",id:"run-with-wasmedge",level:3},{value:"Building a WASI module with Go 1.21",id:"building-a-wasi-module-with-go-121",level:2},{value:"Running the module with WasmEdge",id:"running-the-module-with-wasmedge",level:2},{value:"Networking and WASI limitations",id:"networking-and-wasi-limitations",level:2},{value:"Networking with stealthrocket/net",id:"networking-with-stealthrocketnet",level:2},{value:"Importing host functions in native Go (Go 1.21+)",id:"importing-host-functions-in-native-go-go-121",level:2},{value:"Example",id:"example",level:3}],d={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"native-go-with-wasi-go-121"},"Native Go with WASI (Go 1.21+)"),(0,i.kt)("p",null,"Starting with Go 1.21, the Go toolchain natively supports compiling applications to the WebAssembly System Interface (WASI). This enables developers to build WebAssembly applications using the standard Go compiler and run them on WASI-compliant runtimes such as WasmEdge."),(0,i.kt)("p",null,"This page describes how to develop and run WASI-based applications using native Go with WasmEdge. It also highlights key differences compared to using TinyGo, which has historically been the primary way to run Go applications on WebAssembly."),(0,i.kt)("p",null,"Native Go support is particularly useful for developers who require functionality that is not fully available in the TinyGo standard library, such as more complete language features or integration with existing Go codebases."),(0,i.kt)("h2",{id:"tinygo-vs-native-go"},"TinyGo vs Native Go"),(0,i.kt)("p",null,"There are currently two ways to develop Go applications for WasmEdge: using TinyGo or using the native Go compiler with WASI support introduced in Go 1.21. Each approach has different trade-offs."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Aspect"),(0,i.kt)("th",{parentName:"tr",align:null},"TinyGo"),(0,i.kt)("th",{parentName:"tr",align:null},"Native Go (Go 1.21+)"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Compiler"),(0,i.kt)("td",{parentName:"tr",align:null},"TinyGo (LLVM-based)"),(0,i.kt)("td",{parentName:"tr",align:null},"Standard Go compiler")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Standard library"),(0,i.kt)("td",{parentName:"tr",align:null},"Partial"),(0,i.kt)("td",{parentName:"tr",align:null},"More complete")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"WASI support"),(0,i.kt)("td",{parentName:"tr",align:null},"Mature"),(0,i.kt)("td",{parentName:"tr",align:null},"Introduced in Go 1.21")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Networking"),(0,i.kt)("td",{parentName:"tr",align:null},"Not available by default"),(0,i.kt)("td",{parentName:"tr",align:null},"Not available by default (WASI limitation)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Typical use cases"),(0,i.kt)("td",{parentName:"tr",align:null},"Small, resource-constrained workloads"),(0,i.kt)("td",{parentName:"tr",align:null},"Existing Go codebases, richer language features")))),(0,i.kt)("p",null,"TinyGo has historically been the primary way to run Go applications on WebAssembly and remains a good choice for lightweight workloads. Native Go with WASI support enables developers to reuse more existing Go code and tooling, but it is still subject to the limitations of the WASI environment."),(0,i.kt)("h2",{id:"hello-world-example"},"Hello World example"),(0,i.kt)("p",null,"The following example demonstrates a minimal Go application compiled to WASI and executed using WasmEdge."),(0,i.kt)("h3",{id:"hellogo"},"hello.go"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport "fmt"\n\nfunc main() {\n    fmt.Println("Hello, world")\n}\n')),(0,i.kt)("h3",{id:"build"},"Build"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# initialize a module (optional, but recommended)\ngo mod init hello\n# build a WASI-compatible WebAssembly module\nGOOS=wasip1 GOARCH=wasm go build -o hello.wasm\n")),(0,i.kt)("h3",{id:"run-with-wasmedge"},"Run with WasmEdge"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"wasmedge hello.wasm\n")),(0,i.kt)("p",null,"Expected output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Hello, world\n")),(0,i.kt)("p",null,'Ensure the example prints "Hello, world" when run with WasmEdge. This section is intentionally minimal to demonstrate the native Go WASI path working end-to-end.'),(0,i.kt)("h2",{id:"building-a-wasi-module-with-go-121"},"Building a WASI module with Go 1.21"),(0,i.kt)("p",null,"To compile a Go application to a WASI-compatible WebAssembly module, Go 1.21 or newer is required."),(0,i.kt)("p",null,"Use the following environment variables when building your application:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"GOOS=wasip1 GOARCH=wasm go build -o app.wasm\n")),(0,i.kt)("p",null,"In this command:"),(0,i.kt)("p",null,"GOOS=wasip1 specifies the WASI Preview 1 target"),(0,i.kt)("p",null,"GOARCH=wasm selects the WebAssembly architecture"),(0,i.kt)("p",null,"app.wasm is the generated WebAssembly module"),(0,i.kt)("p",null,"The resulting .wasm file can be executed by WASI-compliant runtimes such as WasmEdge."),(0,i.kt)("h2",{id:"running-the-module-with-wasmedge"},"Running the module with WasmEdge"),(0,i.kt)("p",null,"After building the WebAssembly module (for example, ",(0,i.kt)("inlineCode",{parentName:"p"},"app.wasm"),"), it can be executed using the WasmEdge CLI."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"wasmedge app.wasm\n")),(0,i.kt)("p",null,"WasmEdge executes the WASI _start entry point by default. Command-line arguments provided after the module path are forwarded to the module at runtime. The --dir option can be used to preopen host directories for file system access when required."),(0,i.kt)("h2",{id:"networking-and-wasi-limitations"},"Networking and WASI limitations"),(0,i.kt)("p",null,"The current WASI Preview 1 specification does not include native support for networking primitives such as TCP or UDP sockets. As a result, Go packages that depend on the standard ",(0,i.kt)("inlineCode",{parentName:"p"},"net")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"net/http")," libraries cannot function out of the box in a WASI environment."),(0,i.kt)("p",null,"This limitation applies to both TinyGo and native Go when targeting WASI and is not specific to WasmEdge. Networking support requires additional abstractions or host-provided functionality, which are discussed in the following sections."),(0,i.kt)("h2",{id:"networking-with-stealthrocketnet"},"Networking with stealthrocket/net"),(0,i.kt)("p",null,"To work around the lack of native networking support in WASI Preview 1,\nalternative approaches are required. One such experimental approach is the use\nof the external ",(0,i.kt)("inlineCode",{parentName:"p"},"stealthrocket/net")," project, which provides a networking\nimplementation designed for WASI environments."),(0,i.kt)("p",null,"Rather than relying on traditional socket APIs, ",(0,i.kt)("inlineCode",{parentName:"p"},"stealthrocket/net")," forwards\nnetwork requests to host-provided functionality. This can enable limited HTTP\nand networking capabilities for Go applications compiled to WASI, depending on\nthe runtime environment."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note"),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"stealthrocket/net")," is ",(0,i.kt)("strong",{parentName:"p"},"not part of WasmEdge")," and is mentioned here only as an\nexternal reference. Usage details, compatibility, and examples should be\nverified directly with the project maintainers.")),(0,i.kt)("p",null,"For more information, see the official repository:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/stealthrocket/net"},"https://github.com/stealthrocket/net"))),(0,i.kt)("h2",{id:"importing-host-functions-in-native-go-go-121"},"Importing host functions in native Go (Go 1.21+)"),(0,i.kt)("p",null,"Native Go applications compiled to WASI can call functions that are implemented\nby the WebAssembly runtime (such as WasmEdge) rather than inside the module\nitself."),(0,i.kt)("p",null,"Starting with Go 1.21, host functions can be declared using the\n",(0,i.kt)("inlineCode",{parentName:"p"},"//go:wasmimport")," directive."),(0,i.kt)("h3",{id:"example"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"package main\n\n//go:wasmimport wasi_snapshot_preview1 proc_exit\nfunc procExit(code uint32)\n\nfunc main() {\n    procExit(0)\n}\n")),(0,i.kt)("p",null,"In this example, proc_exit is a WASI host function provided by the runtime.\nThe implementation is supplied by the WASI environment rather than by Go code\ninside the WebAssembly module."),(0,i.kt)("p",null,"For more details, see the official Go documentation:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://pkg.go.dev/cmd/compile#hdr-Directives"},"https://pkg.go.dev/cmd/compile#hdr-Directives"))))}m.isMDXComponent=!0}}]);