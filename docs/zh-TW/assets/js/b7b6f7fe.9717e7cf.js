"use strict";(self.webpackChunkbook=self.webpackChunkbook||[]).push([[3904],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>b});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),d=u(n),c=l,b=d["".concat(s,".").concat(c)]||d[c]||m[c]||i;return n?a.createElement(b,o(o({ref:t},p),{},{components:n})):a.createElement(b,o({ref:t},p))}));function b(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,o=new Array(i);o[0]=c;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[d]="string"==typeof e?e:l,o[1]=r;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},88459:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>u});var a=n(87462),l=(n(67294),n(3905));const i={sidebar_position:7},o="Build with eBPF Plug-in",r={unversionedId:"contribute/source/plugin/ebpf",id:"contribute/source/plugin/ebpf",title:"Build with eBPF Plug-in",description:"The eBPF (extended Berkeley Packet Filter) plug-in provides an interface to execute eBPF programs in WasmEdge. It allows WasmEdge to execute eBPF code that is compiled into WebAssembly format. This guide will walk you through the steps to build WasmEdge with the eBPF plug-in.",source:"@site/docs/contribute/source/plugin/ebpf.md",sourceDirName:"contribute/source/plugin",slug:"/contribute/source/plugin/ebpf",permalink:"/docs/zh-TW/contribute/source/plugin/ebpf",draft:!1,editUrl:"https://github.com/wasmedge/docs/blob/main/docs/contribute/source/plugin/ebpf.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"contributeSidebar",previous:{title:"Build WasmEdge With WasmEdge-TensorflowLite Plug-in",permalink:"/docs/zh-TW/contribute/source/plugin/tensorflowlite"},next:{title:"Build with Rustls Plug-in",permalink:"/docs/zh-TW/contribute/source/plugin/rusttls"}},s={},u=[{value:"Build the eBPF Plug-in",id:"build-the-ebpf-plug-in",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Build steps",id:"build-steps",level:3},{value:"Use the eBPF Plug-in",id:"use-the-ebpf-plug-in",level:2},{value:"Download Examples",id:"download-examples",level:3},{value:"Build Examples",id:"build-examples",level:3},{value:"Run Examples",id:"run-examples",level:3},{value:"Host Functions",id:"host-functions",level:2}],p={toc:u},d="wrapper";function m(e){let{components:t,...n}=e;return(0,l.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"build-with-ebpf-plug-in"},"Build with eBPF Plug-in"),(0,l.kt)("p",null,"The eBPF (extended Berkeley Packet Filter) plug-in provides an interface to execute eBPF programs in WasmEdge. It allows WasmEdge to execute eBPF code that is compiled into WebAssembly format. This guide will walk you through the steps to build WasmEdge with the eBPF plug-in."),(0,l.kt)("h2",{id:"build-the-ebpf-plug-in"},"Build the eBPF Plug-in"),(0,l.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("p",null,"Before building the eBPF plug-in, ensure that you have the following installed:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"WasmEdge - If you haven't installed it, follow the ",(0,l.kt)("a",{parentName:"li",href:"/docs/zh-TW/contribute/source/os/linux"},"follow the guide to build from source"),"."),(0,l.kt)("li",{parentName:"ul"},"libbpf - This plug-in requires ",(0,l.kt)("inlineCode",{parentName:"li"},"libbpf >= 1.2"),". See ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/libbpf/libbpf#building-libbpf"},"Building libbpf")," for details.")),(0,l.kt)("h3",{id:"build-steps"},"Build steps"),(0,l.kt)("p",null,"To build the eBPF plug-in, run the following commands at the root of the WasmEdge project:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'cmake -DWASMEDGE_PLUGIN_WASM_BPF:BOOL=TRUE -B ./build -G "Unix Makefiles"\ncmake --build ./build\n')),(0,l.kt)("p",null,"Make sure to set ",(0,l.kt)("inlineCode",{parentName:"p"},"WASMEDGE_PLUGIN_WASM_BPF")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"TRUE")," in the command line. This toggle controls the build of the ",(0,l.kt)("inlineCode",{parentName:"p"},"wasm_bpf")," plug-in."),(0,l.kt)("h2",{id:"use-the-ebpf-plug-in"},"Use the eBPF Plug-in"),(0,l.kt)("h3",{id:"download-examples"},"Download Examples"),(0,l.kt)("p",null,"You can download examples of wasm-bpf programs from here:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://eunomia-bpf.github.io/wasm-bpf/examples/runqlat/runqlat.wasm\n")),(0,l.kt)("h3",{id:"build-examples"},"Build Examples"),(0,l.kt)("p",null,"You can also build examples of wasm-bpf programs from the ",(0,l.kt)("inlineCode",{parentName:"p"},"wasm-bpf")," repository:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Install the wasi-sdk if you don't have it:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-17/wasi-sdk-17.0-linux.tar.gz\ntar -zxf wasi-sdk-17.0-linux.tar.gz\nsudo mkdir -p /opt/wasi-sdk/ && sudo mv wasi-sdk-17.0/* /opt/wasi-sdk/\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Build the examples:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/eunomia-bpf/wasm-bpf\ncd wasm-bpf/examples\ngit submodule update --init --recursive\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"For example, to build the execve example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cd execve && make\n")),(0,l.kt)("p",null,"The available examples are:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"bootstrap  execve  go-execve  go-lsm  lsm   opensnoop runqlat  rust-bootstrap  sockfilter  sockops\n")),(0,l.kt)("h3",{id:"run-examples"},"Run Examples"),(0,l.kt)("p",null,"After building, you can find the plug-in at ",(0,l.kt)("inlineCode",{parentName:"p"},"./build/plugins/wasm_bpf/libwasmedgePluginWasmBpf.so")," and the WasmEdge CLI tool at ",(0,l.kt)("inlineCode",{parentName:"p"},"./build/tools/wasmedge/wasmedge"),"."),(0,l.kt)("p",null,"To run the examples, set ",(0,l.kt)("inlineCode",{parentName:"p"},"WASMEDGE_PLUGIN_PATH=./build/plugins/wasm_bpf/")," and run wasmedge:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"WASMEDGE_PLUGIN_PATH=./build/plugins/wasm_bpf/ ./build/tools/wasmedge/wasmedge execve.wasm\n")),(0,l.kt)("p",null,"Adjust ",(0,l.kt)("inlineCode",{parentName:"p"},"WASMEDGE_PLUGIN_PATH")," according to your build directory of the plug-in."),(0,l.kt)("h2",{id:"host-functions"},"Host Functions"),(0,l.kt)("p",null,"This plug-in adds six host functions that give your Wasm application access to eBPF. All of these functions are in the module ",(0,l.kt)("inlineCode",{parentName:"p"},"wasm_bpf"),", if you loaded this plug-in:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},"/// lookup a bpf map fd by name.\ni32 wasm_bpf_map_fd_by_name(u64 obj, u32 name);\n/// detach and close a bpf program.\ni32 wasm_close_bpf_object(u64 obj);\n/// CO-RE load a bpf object into the kernel.\nu64 wasm_load_bpf_object(u32 obj_buf, u32 obj_buf_sz);\n/// attach a bpf program to a kernel hook.\ni32 wasm_attach_bpf_program(u64 obj, u32 name,\n                            u32 attach_target);\n/// poll a bpf buffer, and call a wasm callback indicated by sample_func.\n/// the first time to call this function will open and create a bpf buffer.\ni32 wasm_bpf_buffer_poll(u64 program, i32 fd, u32 sample_func,\n                         u32 ctx, u32 data, i32 max_size,\n                         i32 timeout_ms);\n/// lookup, update, delete, and get_next_key operations on a bpf map.\ni32 wasm_bpf_map_operate(u64 fd, i32 cmd, u32 key, u32 value,\n                         u32 next_key, u64 flags);\n")),(0,l.kt)("p",null,"For more information, you can refer to the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/WasmEdge/WasmEdge/tree/master/plugins/wasmedge_bpf"},"GitHub repository"),"."))}m.isMDXComponent=!0}}]);